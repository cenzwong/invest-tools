<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Range Trading Hub | Computational Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- KaTeX for LaTeX rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Noto+Sans+TC:wght@300;400;700&display=swap');
        
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #0f172a;
            color: #f1f5f9;
        }

        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.2s ease;
        }

        .input-dark {
            background: #334155;
            border: 1px solid #475569;
            color: #f1f5f9;
        }

        .input-dark:focus {
            outline: none;
            border-color: #38bdf8;
            box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.2);
        }

        .tab-active {
            border-bottom: 2px solid #38bdf8;
            color: #38bdf8;
        }

        .info-box {
            background: rgba(15, 23, 42, 0.9);
            border-left: 4px solid #38bdf8;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
        }

        .tooltip-container {
            position: relative;
            display: inline-block;
        }

        .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: #1e293b;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 50;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.75rem;
            line-height: 1.2;
            border: 1px solid #38bdf8;
            pointer-events: none;
        }

        .group:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .katex { font-size: 1.05em; }

        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
    </style>
</head>
<body class="min-h-screen pb-12">

    <!-- Header -->
    <header class="relative py-8 px-6 text-center border-b border-slate-800 bg-slate-900/50">
        <div class="absolute top-4 right-6 flex items-center space-x-2 bg-slate-800 p-1 rounded-lg border border-slate-700">
            <button onclick="setLanguage('en')" id="btn-en" class="px-3 py-1 text-xs font-bold rounded transition-all bg-sky-500 text-white">EN</button>
            <button onclick="setLanguage('zh')" id="btn-zh" class="px-3 py-1 text-xs font-bold rounded transition-all text-slate-400 hover:text-white">繁</button>
        </div>

        <h1 data-i18n="header-title" class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-sky-400 to-indigo-500">
            Range Trading Hub
        </h1>
        <p data-i18n="header-subtitle" class="mt-2 text-slate-400 text-sm md:text-base">Advanced Computational Suite for Sideways Markets</p>
    </header>

    <main class="max-w-6xl mx-auto px-4 mt-8">
        
        <!-- Tabs -->
        <div class="flex justify-center mb-8 space-x-4 md:space-x-8 text-sm font-semibold uppercase tracking-wider border-b border-slate-800">
            <button onclick="switchTab('calculators')" id="tab-calculators" data-i18n="tab-calc" class="pb-4 tab-active transition-all">Calculators</button>
            <button onclick="switchTab('knowledge')" id="tab-knowledge" data-i18n="tab-know" class="pb-4 text-slate-500 hover:text-slate-300 transition-all">Knowledge Base</button>
            <button onclick="switchTab('strategies')" id="tab-strategies" data-i18n="tab-strat" class="pb-4 text-slate-500 hover:text-slate-300 transition-all">Strategies</button>
        </div>

        <!-- CALCULATORS SECTION -->
        <section id="sect-calculators" class="space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                
                <!-- Pivot Point Calculator -->
                <div class="glass-card p-6 rounded-2xl shadow-xl flex flex-col">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <div class="p-2 bg-sky-500/20 rounded-lg">
                                <svg class="w-6 h-6 text-sky-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
                            </div>
                            <h2 data-i18n="calc-pivot-title" class="text-xl font-bold">Pivot Points (Floor)</h2>
                        </div>
                        <button onclick="toggleInfo('pivot')" class="text-slate-500 hover:text-sky-400 transition-colors">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"></path></svg>
                        </button>
                    </div>

                    <div id="info-pivot" class="hidden info-box p-5 mb-6 text-sm">
                        <h4 class="font-bold text-sky-400 mb-2" data-i18n="textbook-pivot-h">Textbook: What are Pivot Points?</h4>
                        <p class="text-slate-300 mb-4" data-i18n="textbook-pivot-p">Pivots are mathematical "gravity centers" based on the previous session's range.</p>
                        <div class="bg-slate-900 rounded-lg p-4 mb-4 overflow-x-auto space-y-4">
                            <div id="latex-pivot-main" class="text-center">$$PP = \frac{High + Low + Close}{3}$$</div>
                            <div id="latex-pivot-sub" class="grid grid-cols-2 gap-2 text-xs">
                                <div>$$R1 = (2 \times PP) - Low$$</div>
                                <div>$$S1 = (2 \times PP) - High$$</div>
                                <div>$$R2 = PP + (High - Low)$$</div>
                                <div>$$S2 = PP - (High - Low)$$</div>
                            </div>
                        </div>
                        <p class="text-xs text-slate-400" data-i18n="textbook-pivot-logic">Logic: $PP$ is the fair value. $R1$ and $S1$ represent the first standard deviation of price movement, while $R2/S2$ are the extreme edges.</p>
                    </div>
                    
                    <div class="space-y-4 flex-grow">
                        <div class="grid grid-cols-3 gap-4">
                            <div class="relative group">
                                <label class="text-xs text-slate-400 flex items-center mb-1">
                                    <span data-i18n="label-high">High</span>
                                    <svg class="w-3 h-3 ml-1 text-slate-500 cursor-help" fill="currentColor" viewBox="0 0 20 20"><path d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"></path></svg>
                                    <span class="tooltip-text" data-i18n="tip-high">Highest price of the previous session.</span>
                                </label>
                                <input type="number" id="pHigh" class="w-full p-2 rounded input-dark">
                            </div>
                            <div class="relative group">
                                <label class="text-xs text-slate-400 flex items-center mb-1">
                                    <span data-i18n="label-low">Low</span>
                                    <svg class="w-3 h-3 ml-1 text-slate-500 cursor-help" fill="currentColor" viewBox="0 0 20 20"><path d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"></path></svg>
                                    <span class="tooltip-text" data-i18n="tip-low">Lowest price of the previous session.</span>
                                </label>
                                <input type="number" id="pLow" class="w-full p-2 rounded input-dark">
                            </div>
                            <div class="relative group">
                                <label class="text-xs text-slate-400 flex items-center mb-1">
                                    <span data-i18n="label-close">Close</span>
                                    <svg class="w-3 h-3 ml-1 text-slate-500 cursor-help" fill="currentColor" viewBox="0 0 20 20"><path d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"></path></svg>
                                    <span class="tooltip-text" data-i18n="tip-close">Closing price of the previous session.</span>
                                </label>
                                <input type="number" id="pClose" class="w-full p-2 rounded input-dark">
                            </div>
                        </div>
                        <button onclick="calculatePivots()" data-i18n="btn-calculate" class="w-full py-3 bg-sky-500 hover:bg-sky-600 rounded-lg font-bold shadow-lg">Generate Levels</button>
                    </div>
                    <div id="pivotDisplay" class="mt-4 space-y-1 hidden"></div>
                </div>

                <!-- Expected Move Calculator -->
                <div class="glass-card p-6 rounded-2xl shadow-xl flex flex-col">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <div class="p-2 bg-purple-500/20 rounded-lg">
                                <svg class="w-6 h-6 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2z"></path></svg>
                            </div>
                            <h2 data-i18n="calc-move-title" class="text-xl font-bold">Expected Range (1 SD)</h2>
                        </div>
                        <button onclick="toggleInfo('move')" class="text-slate-500 hover:text-purple-400">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"></path></svg>
                        </button>
                    </div>

                    <div id="info-move" class="hidden info-box p-5 mb-6 text-sm border-purple-500/50">
                        <h4 class="font-bold text-purple-400 mb-2" data-i18n="textbook-move-h">Textbook: Probability & Risk</h4>
                        <p class="text-slate-300 mb-4" data-i18n="textbook-move-p">Calculates a "1 Standard Deviation" move. Price stays inside this range 68% of the time.</p>
                        <div class="bg-slate-900 rounded-lg p-4 mb-4 overflow-x-auto space-y-4">
                            <div class="text-center">$$Move = Price \times IV \times \sqrt{\frac{T}{365}}$$</div>
                            <div class="text-center text-xs text-purple-300">
                                $$Range = [Price - Move, \ Price + Move]$$
                            </div>
                        </div>
                        <p class="text-xs text-slate-400" data-i18n="textbook-move-logic">Note: The Square Root of Time rule accounts for the fact that volatility is non-linear.</p>
                    </div>
                    
                    <div class="space-y-4 flex-grow">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="relative group">
                                <label class="text-xs text-slate-400 flex items-center mb-1">
                                    <span data-i18n="label-curr-price">Price</span>
                                    <svg class="w-3 h-3 ml-1 text-slate-500 cursor-help" fill="currentColor" viewBox="0 0 20 20"><path d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"></path></svg>
                                    <span class="tooltip-text" data-i18n="tip-price">Current market price of the asset.</span>
                                </label>
                                <input type="number" id="currPrice" class="w-full p-2 rounded input-dark">
                            </div>
                            <div class="relative group">
                                <label class="text-xs text-slate-400 flex items-center mb-1">
                                    <span data-i18n="label-iv">IV %</span>
                                    <svg class="w-3 h-3 ml-1 text-slate-500 cursor-help" fill="currentColor" viewBox="0 0 20 20"><path d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"></path></svg>
                                    <span class="tooltip-text" data-i18n="tip-iv">Implied Volatility (expressed as a annual % percentage).</span>
                                </label>
                                <input type="number" id="ivVal" class="w-full p-2 rounded input-dark">
                            </div>
                        </div>
                        <div class="relative group">
                            <label class="text-xs text-slate-400 flex items-center mb-1">
                                <span data-i18n="label-days">Days</span>
                                <svg class="w-3 h-3 ml-1 text-slate-500 cursor-help" fill="currentColor" viewBox="0 0 20 20"><path d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"></path></svg>
                                <span class="tooltip-text" data-i18n="tip-days">The number of days for the predicted range.</span>
                            </label>
                            <input type="number" id="daysVal" value="1" class="w-full p-2 rounded input-dark">
                        </div>
                        <button onclick="calculateExpectedMove()" data-i18n="btn-prob" class="w-full py-3 bg-purple-500 hover:bg-purple-600 rounded-lg font-bold shadow-lg">Generate Range</button>
                    </div>
                    <div id="moveDisplay" class="mt-4 space-y-1 hidden"></div>
                </div>

                <!-- Position Sizer -->
                <div class="glass-card p-6 rounded-2xl shadow-xl md:col-span-2">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <div class="p-2 bg-emerald-500/20 rounded-lg">
                                <svg class="w-6 h-6 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2"></path></svg>
                            </div>
                            <h2 data-i18n="calc-risk-title" class="text-xl font-bold">Position Size & Risk</h2>
                        </div>
                        <button onclick="toggleInfo('risk')" class="text-slate-500 hover:text-emerald-400">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"></path></svg>
                        </button>
                    </div>

                    <div id="info-risk" class="hidden info-box p-5 mb-6 text-sm border-emerald-500/50">
                        <h4 class="font-bold text-emerald-400 mb-2" data-i18n="textbook-risk-h">Textbook: Risk Management</h4>
                        <p class="text-slate-300 mb-4" data-i18n="textbook-risk-p">Size strictly ensures a "fakeout" doesn't destroy your capital.</p>
                        <div class="bg-slate-900 rounded-lg p-4 mb-2 overflow-x-auto text-center">
                            $$Units = \frac{Account \times Risk\%}{|Entry - Stop|}$$
                        </div>
                        <p class="text-xs text-slate-400" data-i18n="textbook-risk-logic">Logic: The denominator is your "Risk per Unit." Dividing your total risk dollar amount by risk per unit gives you the exact volume to buy.</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="relative group">
                            <label class="text-xs text-slate-400 flex items-center mb-1">
                                <span data-i18n="label-balance">Account ($)</span>
                                <svg class="w-3 h-3 ml-1 text-slate-500 cursor-help" fill="currentColor" viewBox="0 0 20 20"><path d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"></path></svg>
                                <span class="tooltip-text" data-i18n="tip-balance">Total capital available for trading.</span>
                            </label>
                            <input type="number" id="balance" class="w-full p-2 rounded input-dark">
                        </div>
                        <div class="relative group">
                            <label class="text-xs text-slate-400 flex items-center mb-1">
                                <span data-i18n="label-risk-p">Risk %</span>
                                <svg class="w-3 h-3 ml-1 text-slate-500 cursor-help" fill="currentColor" viewBox="0 0 20 20"><path d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"></path></svg>
                                <span class="tooltip-text" data-i18n="tip-risk">Percent of account you are willing to lose on this trade.</span>
                            </label>
                            <input type="number" id="riskPerc" value="1" class="w-full p-2 rounded input-dark">
                        </div>
                        <div class="relative group">
                            <label class="text-xs text-slate-400 flex items-center mb-1">
                                <span data-i18n="label-entry">Entry</span>
                                <svg class="w-3 h-3 ml-1 text-slate-500 cursor-help" fill="currentColor" viewBox="0 0 20 20"><path d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"></path></svg>
                                <span class="tooltip-text" data-i18n="tip-entry">Your planned buy or sell price.</span>
                            </label>
                            <input type="number" id="entry" class="w-full p-2 rounded input-dark">
                        </div>
                        <div class="relative group">
                            <label class="text-xs text-slate-400 flex items-center mb-1">
                                <span data-i18n="label-stop">Stop</span>
                                <svg class="w-3 h-3 ml-1 text-slate-500 cursor-help" fill="currentColor" viewBox="0 0 20 20"><path d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"></path></svg>
                                <span class="tooltip-text" data-i18n="tip-stop">The price at which you will exit the trade if wrong.</span>
                            </label>
                            <input type="number" id="stop" class="w-full p-2 rounded input-dark">
                        </div>
                    </div>
                    <button onclick="calculatePosition()" data-i18n="btn-units" class="w-full mt-4 py-3 bg-emerald-500 hover:bg-emerald-600 rounded-lg font-bold shadow-lg">Calculate Size</button>
                    <div id="positionResult" class="hidden mt-4 p-4 bg-emerald-500/10 border border-emerald-500/30 rounded-xl"></div>
                </div>

            </div>
        </section>

        <!-- KNOWLEDGE SECTION -->
        <section id="sect-knowledge" class="hidden">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Cards remain same but content localized -->
                <div class="glass-card p-6 rounded-2xl flex flex-col">
                    <h3 class="text-sky-400 font-bold text-lg mb-2">ADX</h3>
                    <p data-i18n="know-adx-desc" class="text-slate-400 text-sm mb-4">The ultimate trend filter.</p>
                </div>
                <div class="glass-card p-6 rounded-2xl flex flex-col">
                    <h3 class="text-emerald-400 font-bold text-lg mb-2">RSI</h3>
                    <p data-i18n="know-rsi-desc" class="text-slate-400 text-sm mb-4">Momentum oscillator.</p>
                </div>
            </div>
        </section>
    </main>

    <script>
        const translations = {
            en: {
                "header-title": "Range Trading Hub",
                "header-subtitle": "Professional Computational Textbook",
                "tab-calc": "Calculators", "tab-know": "Knowledge", "tab-strat": "Strategies",
                "calc-pivot-title": "Pivot Points (Floor)", "calc-move-title": "Expected Range (1 SD)", "calc-risk-title": "Risk & Position",
                "label-high": "High", "label-low": "Low", "label-close": "Close",
                "label-curr-price": "Price", "label-iv": "IV %", "label-days": "Days",
                "label-balance": "Account", "label-risk-p": "Risk %", "label-entry": "Entry", "label-stop": "Stop",
                "btn-calculate": "Generate Levels", "btn-prob": "Generate Range", "btn-units": "Calculate Position",
                "textbook-pivot-h": "Textbook: What are Pivot Points?",
                "textbook-pivot-p": "Pivots are mathematical 'gravity centers' based on the previous session's range.",
                "textbook-pivot-logic": "Logic: $PP$ is the fair value. $R1/S1$ identify immediate boundaries, $R2/S2$ are extreme deviation points.",
                "textbook-move-h": "Textbook: Probability & Risk",
                "textbook-move-p": "Calculates a '1 Standard Deviation' move. Price stays inside 68% of the time.",
                "textbook-move-logic": "Formula Breakdown: $IV$ is annual volatility. We divide $T$ by 365 and take the square root to find the expected move for your specific duration.",
                "textbook-risk-h": "Textbook: Risk Management",
                "textbook-risk-p": "Size strictly ensures a 'fakeout' doesn't destroy your capital.",
                "textbook-risk-logic": "Math: Dividing Total Risk Dollars by (Entry - Stop) creates a size where hitting your stop loss results in exactly the loss percentage planned.",
                "tip-high": "The highest price traded in the previous session.",
                "tip-low": "The lowest price traded in the previous session.",
                "tip-close": "The price when the market closed last session.",
                "tip-price": "The current market price of the security.",
                "tip-iv": "Implied Volatility: The market's expectation of a 1-year price swing.",
                "tip-days": "How many days into the future you are projecting.",
                "tip-balance": "Your total trading account equity.",
                "tip-risk": "The % of total equity you are prepared to lose if stop is hit.",
                "tip-entry": "The price you intend to buy or sell at.",
                "tip-stop": "The price where the trade is proven 'wrong' and must be closed.",
                "res-units": "Units", "res-risk": "Risk Amount", "res-upper": "Upper Band", "res-lower": "Lower Band"
            },
            zh: {
                "header-title": "區間交易中心",
                "header-subtitle": "專業級計算教科書",
                "tab-calc": "計算機", "tab-know": "知識庫", "tab-strat": "交易策略",
                "calc-pivot-title": "樞軸點 (Floor)", "calc-move-title": "預期波動 (1 SD)", "calc-risk-title": "風險與倉位",
                "label-high": "最高價", "label-low": "最低價", "label-close": "收市價",
                "label-curr-price": "現價", "label-iv": "隱含波動率 %", "label-days": "天數",
                "label-balance": "賬戶餘額", "label-risk-p": "風險 %", "label-entry": "入場", "label-stop": "止損",
                "btn-calculate": "生成水平", "btn-prob": "生成區間", "btn-units": "計算倉位",
                "textbook-pivot-h": "教科書：什麼是樞軸點？",
                "textbook-pivot-p": "樞軸點是基於前一交易日價格範圍的數學「重力中心」。",
                "textbook-pivot-logic": "邏輯：$PP$ 為公允價值。$R1/S1$ 識別即時邊界，$R2/S2$ 為極端偏離點。",
                "textbook-move-h": "教科書：概率與風險",
                "textbook-move-p": "計算「1 個標準差」的移動。統計上，價格有 68% 的時間會留在該範圍內。",
                "textbook-move-logic": "公式解析：$IV$ 為年度波動率。我們將 $T$ 除以 365 並取平方根，以得出特定時間內的預期波動。",
                "textbook-risk-h": "教科書：風險管理",
                "textbook-risk-p": "嚴格控制倉位，確保假突破不會毀掉你的資本。",
                "textbook-risk-logic": "數學邏輯：將總風險金額除以（入場價 - 止損價），即可得出一個觸及止損時損失剛好等於預設比例的倉位。",
                "tip-high": "前一交易日的最高成交價格。",
                "tip-low": "前一交易日的最低成交價格。",
                "tip-close": "前一交易日市場收市時的價格。",
                "tip-price": "證券的當前市場價格。",
                "tip-iv": "隱含波動率：市場對未來一年價格波動幅度的預期。",
                "tip-days": "你希望預測未來多少天的價格波動範圍。",
                "tip-balance": "你的交易賬戶總資產。",
                "tip-risk": "如果觸及止損，你準備損失總資產的百分比。",
                "tip-entry": "你打算買入或賣出的預定價格。",
                "tip-stop": "當交易被證明「錯誤」且必須平倉時的價格。",
                "res-units": "成交單位數量", "res-risk": "風險金額", "res-upper": "上限值", "res-lower": "下限值"
            }
        };

        let currentLang = 'en';

        function setLanguage(lang) {
            currentLang = lang;
            document.getElementById('btn-en').className = lang === 'en' ? 'px-3 py-1 text-xs font-bold rounded transition-all bg-sky-500 text-white' : 'px-3 py-1 text-xs font-bold rounded transition-all text-slate-400 hover:text-white';
            document.getElementById('btn-zh').className = lang === 'zh' ? 'px-3 py-1 text-xs font-bold rounded transition-all bg-sky-500 text-white' : 'px-3 py-1 text-xs font-bold rounded transition-all text-slate-400 hover:text-white';
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[lang][key]) el.innerText = translations[lang][key];
            });
            renderMathInElement(document.body);
        }

        function switchTab(tabId) {
            ['calculators', 'knowledge', 'strategies'].forEach(t => {
                document.getElementById('tab-' + t).classList.replace('tab-active', 'text-slate-500');
                document.getElementById('sect-' + t).classList.add('hidden');
            });
            document.getElementById('tab-' + tabId).classList.replace('text-slate-500', 'tab-active');
            document.getElementById('sect-' + tabId).classList.remove('hidden');
        }

        function toggleInfo(id) {
            document.getElementById('info-' + id).classList.toggle('hidden');
            renderMathInElement(document.body);
        }

        function calculatePivots() {
            const h = parseFloat(document.getElementById('pHigh').value);
            const l = parseFloat(document.getElementById('pLow').value);
            const c = parseFloat(document.getElementById('pClose').value);
            if (isNaN(h)) return;
            const pp = (h + l + c) / 3;
            const r1 = (2 * pp) - l;
            const s1 = (2 * pp) - h;
            const r2 = pp + (h - l);
            const s2 = pp - (h - l);
            const display = document.getElementById('pivotDisplay');
            display.classList.remove('hidden');
            display.innerHTML = `
                <div class="flex justify-between p-2 text-red-400 border-b border-slate-700"><span>R2</span><strong>${r2.toFixed(2)}</strong></div>
                <div class="flex justify-between p-2 text-red-300 border-b border-slate-700"><span>R1</span><strong>${r1.toFixed(2)}</strong></div>
                <div class="flex justify-between p-2 text-sky-400 font-bold bg-sky-500/10 rounded"><span>PP</span><strong>${pp.toFixed(2)}</strong></div>
                <div class="flex justify-between p-2 text-emerald-300 border-b border-slate-700"><span>S1</span><strong>${s1.toFixed(2)}</strong></div>
                <div class="flex justify-between p-2 text-emerald-400"><span>S2</span><strong>${s2.toFixed(2)}</strong></div>
            `;
        }

        function calculateExpectedMove() {
            const cp = parseFloat(document.getElementById('currPrice').value);
            const iv = parseFloat(document.getElementById('ivVal').value) / 100;
            const days = parseFloat(document.getElementById('daysVal').value);
            if (isNaN(cp)) return;
            const move = cp * iv * Math.sqrt(days / 365);
            const upper = cp + move;
            const lower = cp - move;
            const display = document.getElementById('moveDisplay');
            display.classList.remove('hidden');
            display.innerHTML = `
                <div class="flex justify-between p-2 text-slate-400 border-b border-slate-700"><span>Move ±</span><strong>${move.toFixed(2)}</strong></div>
                <div class="flex justify-between p-2 text-red-400 font-bold"><span>${translations[currentLang]['res-upper']}</span><strong>${upper.toFixed(2)}</strong></div>
                <div class="flex justify-between p-2 text-emerald-400 font-bold"><span>${translations[currentLang]['res-lower']}</span><strong>${lower.toFixed(2)}</strong></div>
            `;
        }

        function calculatePosition() {
            const bal = parseFloat(document.getElementById('balance').value);
            const rP = parseFloat(document.getElementById('riskPerc').value) / 100;
            const ent = parseFloat(document.getElementById('entry').value);
            const stp = parseFloat(document.getElementById('stop').value);
            if (isNaN(bal) || isNaN(ent) || isNaN(stp)) return;
            const riskAmt = bal * rP;
            const dist = Math.abs(ent - stp);
            const units = dist === 0 ? 0 : riskAmt / dist;
            const res = document.getElementById('positionResult');
            res.classList.remove('hidden');
            res.innerHTML = `
                <div class="text-slate-400 text-xs mb-1">${translations[currentLang]['res-risk']}: $${riskAmt.toFixed(2)}</div>
                <div class="text-2xl font-bold text-emerald-400">${units.toFixed(2)} ${translations[currentLang]['res-units']}</div>
            `;
        }

        window.onload = () => renderMathInElement(document.body);
    </script>
</body>
</html>

